---
title: SQL基础知识
toc: true
date: 2018-09-28 16:51:30
tags: [SQL]
categories: [程序语言]
---

# SQL命令分类
|    语言类型     |                           基础命令                           |
| :-------------: | :----------------------------------------------------------: |
| 数据定义语言DDL | CREATE（TABLE、INDEX、VIEW）、ALTER（TABLE、INDEX）、DROP（TABLE、INDEX、VIEW） |
| 数据操作语言DML |                    INSERT、UPDATE、DELETE                    |
| 数据查询语言DQL |                            SELECT                            |
| 数据控制语言DCL |        ALTER PASSWORD、GRANT、REVOKE、CREATE SYNONYM         |
|  数据管理命令   |                   START AUDIT、STOP AUDIT                    |
|  事务控制命令   |         COMMIT、ROLLBACK、SAVEPOINT、SET TRANSACTION         |
# DDL
1. 创建表

```SQL
CREATE TABLE STUDENT_TBL
(
STUD_ID CHAR(9) NOT NULL,
STUD_NAME VARCHAR(40) NOT NULL
);

CREATE TABLE STUDENT_BACKUP_TBL AS
SELECT * FROM STUDENT_TBL;
```
2. 修改表

```SQL
ALTER TABLE STUDENT_TBL MODIFY
STUD_ID CHAR(10);
```
3. 删除表

```SQL
DROP TABLE STUDENT_TBL;
```
# 完整性约束
1. 主键约束

```SQL
CREATE TABLE STUDENT_TBL
(
STUD_ID CHAR(9) NOT NULL PRIMAARY KEY,
STUD_NAME VARCHAR(40) NOT NULL
);

CREATE TABLE STUDENT_TBL
(
STUD_ID CHAR(9) NOT NULL,
STUD_NAME VARCHAR(40) NOT NULL,
PRIMARY KEY(STUD_ID, STUD_NAME)
);

ALTER TABLE STUDENT_TBL
ADD CONSTRAINT STUD_PK PRIMARY KEY(STUD_ID, STUD_NAME);
```
2. 唯一性约束

```SQL
CREATE TABLE STUDENT_TBL
(
STUD_ID CHAR(9) NOT NULL PRIMAARY KEY,
STUD_NAME VARCHAR(40) NOT NULL UNIQUE
);
```
3. 外键约束

```SQL
CREATE TABLE STUDENT_SCORE_TBL
(
STUD_ID CHAR(9) NOT NULL,
ENGLISH INT,
CONSTRAINT STUD_ID_FK FOREIGN KEY (STUD_ID) REFERENCES STUDENT_TBL (STUD_ID)
);
```
3. NOT NULL约束

4. 检查约束

```SQL
CREATE TABLE STUDENT_SCORE_TBL
(
STUD_ID CHAR(9) NOT NULL,
ENGLISH INT,
CONSTRAINT ENGLISH_CHK CHECK ( 0 <= ENGLISH <= 100)
); 
```
5. 去除约束

```SQL
ALTER TABLE  STUDENT_SCORE_TBL DROP CONSTRAINT ENGLISH_CHK;
```
# DML
1. 插入行

```SQL
INSERT INTO STUDENT_TBL
VALUES('001', 'LEE');
```
2. 插入数据到指定列

```SQL
INSERT INTO STUDENT_SCORE_TBL(STUD_ID,ENGLISH)
VALUES('001', 90);
```
3. 从另一个表插入数据

```SQL
INSERT INTO STUDENT_BACKUP_TBL(STUD_ID,STUD_NAME)
SELECT * FROM STUDENT_TBL;
```
4. 插入NULL值

```SQL
INSERT INTO STUDENT_SCORE_TBL
('001',NULL);
```
5. 更新现有数据

```SQL
UPDATE STUDENT_SCORE_TBL
SET SCORE = 90
WHERE STUD_ID = '001';
```
5. 删除数据

```SQL
DELETE FROM STUDENT_TBL
WHERE STUD_ID = '001'
```

# 事务控制
1. COMMIT

   提交上一次COMMIT或ROllBACK之后的全部事务

2. ROLLBACK

   撤销上一次COMMIT或ROllBACK之后的全部事务

3. SAVEPOINT

   保存点是事务过程中的一个逻辑点，我们可以将事务回退到这个点，而不必撤回全部事务。

4. ROLLBACK TO SAVEPOINT

   将事务撤回保存点

5. RELEASE SAVEPOINT

   删除创建的保存点

```SQL
DELETE FROM STUDENT_TBL
WHERE STUD_ID = '003'
SAVEPOINT SP1
DELETE FROM STUDENT_TBL
WHERE STUD_ID = '002'
SAVEPOINT SP2
DELETE FROM STUDENT_TBL
WHERE STUD_ID = '001'
ROLLBACK TO SP2
RELEASE SP1
```
6. SET TRANSACTION

   用于初始化数据库事务，指定事务的特性。

# DQL
1. 删除重复记录 

   DISTINCT用于去除结果中的重复记录。

```SQL
SELECT DISTINCT(STUD_NAME) FROM STUDENT_TBL
```
2. 输出结果排序

   ASC/DESC: 生序/降序

```SQL
SELECT * FROM STUDENT_SCORE_TBL
WHERE ENGLISH >= 60
ORDER BY ENGLISH DESC;
```
3. 输出结果分组

```SQL
SELECT * FROM STUDENT_SCORE_TBL
WHERE ENGLISH >= 60
GROUP BY ENGLISH;
```
4. 统计表里的记录数量

```SQL
SELECT COUNT(*) FROM STUDENT_SCORE_TBL
WHERE ENGLISH >= 60;
```
5. 使用字段别名

```SQL
SELECT STUD_NAME NAME FROM STUDENT_TBL;
```

# 逻辑操作符
1. IS NULL

```SQL
SELECT COUNT(*) FROM STUDENT_SCORE_TBL
WHERE ENGLISH IS NULL;
```
2. BETWEEN

```SQL
SELECT COUNT(*) FROM STUDENT_SCORE_TBL
WHERE ENGLISH BETWEEN 60 AND 80;
```
3. IN 

```SQL
SELECT COUNT(*) FROM STUDENT_SCORE_TBL
WHERE STUD_ID IN ('001','002');
```
4. LIKE

   利用通配符把一个值与类似的值做比较，通配符有：

   %： 代表零个，一个，或多个字符

   _： 代表一个数字或一个字符

```SQL
SELECT * FROM STUDENT_SCORE_TBL
WHERE STUD_ID LIKE '00_'
```
5. EXISTS

```SQL
SELECT STUD_ID FROM STUDENT_SCORE_TBL
WHERE EXISTS
(
SELECT * FROM STUDENT_SCORE_TBL
WHERE ENGLISH >= 60
);
```
6. UNIQUE

7. ALL / SOME(ANY)

```SQL
SELECT STUD_ID FROM STUDENT_SCORE_TBL
WHERE ENGLISH > ALL
(
SELECT * FROM STUDENT_SCORE_TBL
WHERE ENGLISH BETWEEN 50 AND 70
);
```
8. AND / OR

9. NOT求反操作符

# 汇总函数
1. COUNT
2. SUM
3. MAX
4. MIN
5. AVG

## 汇总函数与分组函数结合
```SQL
SELECT SUM(ENGLISH) FROM STUDENT_SCORE_TBL
WHERE ENGLISH >= 0
GROUP BY ENGLISH
```
**注意：SELECT语句里出现的所有字段，出去汇总字段，都必须出现在GROUP BY里面**

## CUBE AND ROLLUP
ROLLUP可以在全部分组的基础上，对其中一小部分进行汇总。
```SQL
SELECT AVG(AGE) FROM STUDENT_TBL
GROUP BY ROLLUP(STUD_CITY,STUD_GENDER)
```
**ROLLUP**按照从右至左的顺序，每次去掉括号里的最后一个字段，并根据剩余的字段进行分组统计，将结果插入返回表，最后，还对全表进行了一次分组统计。

**CUBE**对分组中的所有字段进行排列组合，根据每一种组合分别进行统计汇总。最后，再对全表进行统计汇总。

## HAVING
跟在GROUP BY之后，ORDER BY之前使用，用于筛选分组结果中满足条件的分组。
```SQL
SELECT AVG(AGE) FROM STUDENT_TBL
GROUP BY ROLLUP(STUD_CITY)
HAVING AVG(AGE) >= 20
```